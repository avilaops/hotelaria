@page "/"
@inject ReservaService ReservaService
@inject QuartoService QuartoService
@inject HospedeService HospedeService

<PageTitle>Dashboard - Hotelaria</PageTitle>

<div class="dashboard-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="wave">üëã</span> Bem-vindo ao Hotelaria
            </h1>
            <p class="hero-subtitle">Sistema completo de gest√£o hoteleira</p>
        </div>
        <div class="hero-time">
            <div class="time-display">@DateTime.Now.ToString("HH:mm")</div>
            <div class="date-display">@DateTime.Now.ToString("dddd, dd MMMM yyyy")</div>
        </div>
    </div>

    <!-- Quick Stats Grid -->
    <div class="quick-stats-grid">
        <div class="stat-card highlight-blue">
            <div class="stat-header">
                <span class="stat-icon">üìã</span>
                <span class="stat-badge new">Hoje</span>
            </div>
            <div class="stat-body">
                <h2 class="stat-number">@totalReservas</h2>
                <p class="stat-label">Total de Reservas</p>
                <div class="stat-trend">
                    <span class="trend-up">‚Üó +@novasReservasHoje</span>
                    <span>hoje</span>
                </div>
            </div>
        </div>

        <div class="stat-card highlight-green">
            <div class="stat-header">
                <span class="stat-icon">‚úÖ</span>
                <span class="stat-badge">Ativas</span>
            </div>
            <div class="stat-body">
                <h2 class="stat-number">@reservasConfirmadas</h2>
                <p class="stat-label">Confirmadas</p>
                <div class="stat-trend">
                    <span class="percentage">@((decimal)reservasConfirmadas / totalReservas * 100:F0)%</span>
                    <span>do total</span>
                </div>
            </div>
        </div>

        <div class="stat-card highlight-orange">
            <div class="stat-header">
                <span class="stat-icon">üîë</span>
                <span class="stat-badge">Hoje</span>
            </div>
            <div class="stat-body">
                <h2 class="stat-number">@checkinsHoje</h2>
                <p class="stat-label">Check-ins Realizados</p>
                <div class="stat-list-mini">
                    @foreach (var reserva in proximosCheckins.Take(2))
                    {
                        <div class="mini-item">‚Ä¢ @reserva.Hospede?.Nome</div>
                    }
                </div>
            </div>
        </div>

        <div class="stat-card highlight-purple">
            <div class="stat-header">
                <span class="stat-icon">‚è≥</span>
                <span class="stat-badge">Pendente</span>
            </div>
            <div class="stat-body">
                <h2 class="stat-number">@reservasPendentes</h2>
                <p class="stat-label">Pendentes</p>
                @if (reservasPendentes > 0)
                {
                    <button class="stat-action" onclick="location.href='/reservas'">
                        Ver detalhes ‚Üí
                    </button>
                }
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content-grid">
        <!-- Proximos Check-ins -->
        <div class="content-card">
            <div class="card-header">
                <h3><span class="icon">üîë</span> Pr√≥ximos Check-ins</h3>
                <span class="card-badge">@proximosCheckins.Count</span>
            </div>
            <div class="card-body">
                @if (proximosCheckIns.Any())
                {
                    @foreach (var reserva in proximosCheckIns.Take(5))
                    {
                        <div class="checkin-item">
                            <div class="checkin-avatar">
                                @GetInitials(reserva.Hospede?.Nome)
                            </div>
                            <div class="checkin-info">
                                <div class="checkin-name">@reserva.Hospede?.Nome</div>
                                <div class="checkin-details">
                                    <span class="room-badge">Quarto @reserva.Quarto?.Numero</span>
                                    <span class="time-info">@reserva.CheckIn.ToString("HH:mm")</span>
                                </div>
                            </div>
                            <button class="checkin-btn" onclick="location.href='/reservas'">
                                Check-in
                            </button>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>Nenhum check-in previsto</p>
                    </div>
                }
            </div>
        </div>

        <!-- Status dos Quartos -->
        <div class="content-card">
            <div class="card-header">
                <h3><span class="icon">üè®</span> Quartos</h3>
                <a href="/disponibilidade" class="card-link">Ver todos ‚Üí</a>
            </div>
            <div class="card-body">
                <div class="rooms-stats">
                    <div class="room-stat-item available">
                        <div class="room-stat-number">@quartosDisponiveis</div>
                        <div class="room-stat-label">Dispon√≠veis</div>
                    </div>
                    <div class="room-stat-item occupied">
                        <div class="room-stat-number">@quartosOcupados</div>
                        <div class="room-stat-label">Ocupados</div>
                    </div>
                    <div class="room-stat-item maintenance">
                        <div class="room-stat-number">@quartosManutencao</div>
                        <div class="room-stat-label">Manuten√ß√£o</div>
                    </div>
                </div>
                
                <div class="occupancy-bar-container">
                    <div class="occupancy-label">
                        <span>Taxa de Ocupa√ß√£o</span>
                        <span class="occupancy-percentage">@taxaOcupacao.ToString("F0")%</span>
                    </div>
                    <div class="occupancy-bar">
                        <div class="occupancy-fill" style="width: @taxaOcupacao%"></div>
                    </div>
                </div>

                <div class="rooms-list">
                    @foreach (var quarto in QuartoService.ObterTodos().Take(4))
                    {
                        <div class="room-item">
                            <div class="room-number">@quarto.Numero</div>
                            <div class="room-type">@GetTipoQuarto(quarto.Tipo)</div>
                            <div class="room-status @GetStatusClass(quarto.Status)">
                                @GetStatusTexto(quarto.Status)
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Grid -->
    <div class="bottom-grid">
        <!-- Receita Mensal -->
        <div class="content-card revenue-card">
            <div class="card-header">
                <h3><span class="icon">üí∞</span> Receita do M√™s</h3>
                <span class="month-label">@DateTime.Now.ToString("MMMM")</span>
            </div>
            <div class="card-body">
                <div class="revenue-display">
                    <div class="revenue-amount">‚Ç¨ @receitaMensal.ToString("N2")</div>
                    <div class="revenue-trend positive">
                        <span>‚Üó +15%</span>
                        <span class="trend-label">vs m√™s anterior</span>
                    </div>
                </div>
                <div class="revenue-breakdown">
                    <div class="breakdown-item">
                        <span>Booking.com</span>
                        <span class="breakdown-value">‚Ç¨ @(receitaMensal * 0.6m).ToString("N0")</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Direto</span>
                        <span class="breakdown-value">‚Ç¨ @(receitaMensal * 0.3m).ToString("N0")</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Airbnb</span>
                        <span class="breakdown-value">‚Ç¨ @(receitaMensal * 0.1m).ToString("N0")</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- A√ß√µes R√°pidas -->
        <div class="content-card quick-actions-card">
            <div class="card-header">
                <h3><span class="icon">‚ö°</span> A√ß√µes R√°pidas</h3>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <button class="action-btn primary" onclick="location.href='/reservas'">
                        <span class="action-icon">‚ûï</span>
                        <span class="action-text">Nova Reserva</span>
                    </button>
                    <button class="action-btn secondary" onclick="location.href='/hospedes'">
                        <span class="action-icon">üë§</span>
                        <span class="action-text">Novo H√≥spede</span>
                    </button>
                    <button class="action-btn tertiary" onclick="location.href='/relatorios'">
                        <span class="action-icon">üìä</span>
                        <span class="action-text">Relat√≥rios</span>
                    </button>
                    <button class="action-btn quaternary" onclick="location.href='/mensagens'">
                        <span class="action-icon">üí¨</span>
                        <span class="action-text">Mensagens</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .dashboard-container {
        padding: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }

    /* Hero Section */
    .hero-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 30px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hero-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .wave {
        display: inline-block;
        animation: wave 2s infinite;
    }

    @@keyframes wave {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(20deg); }
        75% { transform: rotate(-20deg); }
    }

    .hero-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
        margin: 10px 0 0 0;
    }

    .hero-time {
        text-align: right;
    }

    .time-display {
        font-size: 3rem;
        font-weight: 700;
        color: white;
        line-height: 1;
    }

    .date-display {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        margin-top: 5px;
        text-transform: capitalize;
    }

    /* Quick Stats Grid */
    .quick-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        border-left: 4px solid;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
    }

    .stat-card.highlight-blue { border-left-color: #2196F3; }
    .stat-card.highlight-green { border-left-color: #4CAF50; }
    .stat-card.highlight-orange { border-left-color: #FF9800; }
    .stat-card.highlight-purple { border-left-color: #9C27B0; }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .stat-icon {
        font-size: 2rem;
    }

    .stat-badge {
        padding: 4px 12px;
        background: #f0f0f0;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        color: #666;
    }

    .stat-badge.new {
        background: #E3F2FD;
        color: #2196F3;
    }

    .stat-number {
        font-size: 3rem;
        font-weight: 800;
        margin: 0;
        color: #2c3e50;
        line-height: 1;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 1rem;
        margin: 10px 0;
    }

    .stat-trend {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }

    .trend-up {
        color: #4CAF50;
        font-weight: 600;
    }

    .percentage {
        background: #E8F5E9;
        color: #2E7D32;
        padding: 2px 8px;
        border-radius: 6px;
        font-weight: 600;
    }

    .stat-list-mini {
        margin-top: 10px;
        font-size: 0.85rem;
        color: #666;
    }

    .mini-item {
        padding: 3px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .stat-action {
        margin-top: 10px;
        padding: 8px 16px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* Main Content Grid */
    .main-content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .content-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .card-header {
        padding: 20px 25px;
        border-bottom: 1px solid #ecf0f1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
    }

    .card-header h3 {
        margin: 0;
        font-size: 1.1rem;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .card-badge {
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .card-link {
        color: #667eea;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .card-body {
        padding: 20px 25px;
    }

    /* Check-in Items */
    .checkin-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 12px;
        transition: background 0.2s;
    }

    .checkin-item:hover {
        background: #e8f4f8;
    }

    .checkin-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.2rem;
    }

    .checkin-info {
        flex: 1;
    }

    .checkin-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .checkin-details {
        display: flex;
        gap: 10px;
        font-size: 0.85rem;
    }

    .room-badge {
        background: #E3F2FD;
        color: #2196F3;
        padding: 2px 8px;
        border-radius: 6px;
    }

    .time-info {
        color: #7f8c8d;
    }

    .checkin-btn {
        padding: 8px 16px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: background 0.2s;
    }

    .checkin-btn:hover {
        background: #388E3C;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #95a5a6;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 10px;
    }

    /* Rooms Stats */
    .rooms-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }

    .room-stat-item {
        text-align: center;
        padding: 20px;
        border-radius: 12px;
    }

    .room-stat-item.available { background: #E8F5E9; }
    .room-stat-item.occupied { background: #E3F2FD; }
    .room-stat-item.maintenance { background: #FFF3E0; }

    .room-stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .room-stat-item.available .room-stat-number { color: #4CAF50; }
    .room-stat-item.occupied .room-stat-number { color: #2196F3; }
    .room-stat-item.maintenance .room-stat-number { color: #FF9800; }

    .room-stat-label {
        font-size: 0.85rem;
        color: #666;
    }

    /* Occupancy Bar */
    .occupancy-bar-container {
        margin-bottom: 20px;
    }

    .occupancy-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
        color: #2c3e50;
    }

    .occupancy-percentage {
        font-weight: 700;
        color: #667eea;
    }

    .occupancy-bar {
        height: 12px;
        background: #ecf0f1;
        border-radius: 6px;
        overflow: hidden;
    }

    .occupancy-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 6px;
        transition: width 0.5s ease;
    }

    /* Rooms List */
    .rooms-list {
        display: grid;
        gap: 10px;
    }

    .room-item {
        display: grid;
        grid-template-columns: 60px 1fr auto;
        align-items: center;
        gap: 15px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .room-number {
        font-weight: 700;
        font-size: 1.1rem;
        color: #2c3e50;
    }

    .room-type {
        color: #7f8c8d;
        font-size: 0.9rem;
    }

    .room-status {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .room-status.disponivel { background: #E8F5E9; color: #2E7D32; }
    .room-status.ocupado { background: #E3F2FD; color: #1565C0; }
    .room-status.limpeza { background: #FFF3E0; color: #E65100; }

    /* Bottom Grid */
    .bottom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
    }

    /* Revenue Card */
    .revenue-display {
        margin-bottom: 20px;
    }

    .revenue-amount {
        font-size: 3rem;
        font-weight: 800;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .revenue-trend {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .revenue-trend.positive {
        color: #4CAF50;
        font-weight: 600;
    }

    .trend-label {
        color: #7f8c8d;
        font-size: 0.9rem;
    }

    .revenue-breakdown {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .breakdown-item {
        display: flex;
        justify-content: space-between;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .breakdown-value {
        font-weight: 700;
        color: #2c3e50;
    }

    /* Quick Actions */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .action-btn {
        padding: 20px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
        font-family: inherit;
    }

    .action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .action-btn.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .action-btn.secondary {
        background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        color: white;
    }

    .action-btn.tertiary {
        background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
        color: white;
    }

    .action-btn.quaternary {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
    }

    .action-icon {
        font-size: 2rem;
    }

    .action-text {
        font-weight: 600;
        font-size: 1rem;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .dashboard-container {
            padding: 15px;
        }

        .hero-section {
            flex-direction: column;
            text-align: center;
        }

        .hero-title {
            font-size: 1.8rem;
        }

        .hero-time {
            text-align: center;
        }

        .quick-stats-grid,
        .main-content-grid,
        .bottom-grid {
            grid-template-columns: 1fr;
        }

        .quick-actions {
            grid-template-columns: 1fr;
        }
    }
</style>

@code {
    private int totalReservas = 0;
    private int reservasConfirmadas = 0;
    private int checkinsHoje = 0;
    private int reservasPendentes = 0;
    private int novasReservasHoje = 0;
    
    private int quartosDisponiveis = 0;
    private int quartosOcupados = 0;
    private int quartosManutencao = 0;
    private decimal taxaOcupacao = 0;
    
    private decimal receitaMensal = 0;
    
    private List<Reserva> proximosCheckins = new();

    protected override void OnInitialized()
    {
        CarregarDadosDashboard();
    }

    private void CarregarDadosDashboard()
    {
        var todasReservas = ReservaService.ObterTodas();
        
        totalReservas = todasReservas.Count;
        reservasConfirmadas = todasReservas.Count(r => r.Status == StatusReserva.Confirmada);
        checkinsHoje = todasReservas.Count(r => r.CheckIn.Date == DateTime.Today && r.Status == StatusReserva.CheckInRealizado);
        reservasPendentes = todasReservas.Count(r => r.Status == StatusReserva.Pendente);
        novasReservasHoje = todasReservas.Count(r => r.DataReserva.Date == DateTime.Today);
        
        proximosCheckins = todasReservas
            .Where(r => r.CheckIn.Date >= DateTime.Today && r.Status == StatusReserva.Confirmada)
            .OrderBy(r => r.CheckIn)
            .ToList();
        
        var todosQuartos = QuartoService.ObterTodos();
        quartosDisponiveis = todosQuartos.Count(q => q.Status == StatusQuarto.Disponivel);
        quartosOcupados = todosQuartos.Count(q => q.Status == StatusQuarto.Ocupado);
        quartosManutencao = todosQuartos.Count(q => q.Status == StatusQuarto.Manutencao);
        
        var totalQuartos = todosQuartos.Count;
        taxaOcupacao = totalQuartos > 0 ? (decimal)quartosOcupados / totalQuartos * 100 : 0;
        
        var inicioMes = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1);
        receitaMensal = todasReservas
            .Where(r => r.DataReserva >= inicioMes && r.Status != StatusReserva.Cancelada)
            .Sum(r => r.ValorTotal);
    }

    private string GetInitials(string? nome)
    {
        if (string.IsNullOrEmpty(nome)) return "?";
        var partes = nome.Split(' ');
        if (partes.Length >= 2)
            return $"{partes[0][0]}{partes[1][0]}".ToUpper();
        return nome.Substring(0, Math.Min(2, nome.Length)).ToUpper();
    }

    private string GetTipoQuarto(TipoQuarto tipo) => tipo switch
    {
        TipoQuarto.Standard => "Standard",
        TipoQuarto.Deluxe => "Deluxe",
        TipoQuarto.Suite => "Su√≠te",
        TipoQuarto.Presidential => "Presidential",
        _ => ""
    };

    private string GetStatusTexto(StatusQuarto status) => status switch
    {
        StatusQuarto.Disponivel => "Dispon√≠vel",
        StatusQuarto.Ocupado => "Ocupado",
        StatusQuarto.Limpeza => "Limpeza",
        StatusQuarto.Manutencao => "Manuten√ß√£o",
        _ => ""
    };

    private string GetStatusClass(StatusQuarto status) => status switch
    {
        StatusQuarto.Disponivel => "disponivel",
        StatusQuarto.Ocupado => "ocupado",
        StatusQuarto.Limpeza => "limpeza",
        StatusQuarto.Manutencao => "manutencao",
        _ => ""
    };
}
